{% load basefilter %}
<html>
<head>
    <meta charset="UTF-8">
    <title>商业供应链系统</title>
</head>
<body>
{% include 'common/nav.html' %}
<script type="text/javascript" src="{{ static }}/js/handsontable.full.min.js"></script>
<script type="text/javascript" src="{{ static }}/js/handsontable/handsontable.helper.js"></script>
<link type="text/css" rel="stylesheet" href="{{ static }}/css/handsontable.css">
<div class="notice noticeOrder comWidth" style="width: inherit">
    <div class="tTitle">
        <a class="button right" href="javascript:void(0);" id="btnExport">导出Excel</a>
        <div class="container">
            <ul class="nav nav-tabs">
                <li role="presentation" class="active"><a href="#">门店排名</a></li>
                <li role="presentation"><a href="#">德汇店</a></li>
                <li role="presentation"><a href="#">商城店</a></li>
                <li role="presentation"><a href="#">双百店</a></li>
                <li role="presentation"><a href="#">滦河店</a></li>
                <li role="presentation"><a href="#">广场店</a></li>
                <li role="presentation"><a href="#">购物店</a></li>
                <li role="presentation"><a href="#">围场店</a></li>
                <li role="presentation"><a href="#">丰润店</a></li>
                <li role="presentation"><a href="#">丰百店</a></li>
                <li role="presentation"><a href="#">平泉店</a></li>
                <li role="presentation"><a href="#">滦平店</a></li>
                <li role="presentation"><a href="#">隆化店</a></li>
                <li role="presentation"><a href="#">双滦广场店</a></li>
                <li role="presentation"><a href="#">安定里店</a></li>
                <li role="presentation"><a href="#">奥体店</a></li>
                <li role="presentation"><a href="#">天山店</a></li>
                <li role="presentation"><a href="#">美神店</a></li>
                <li role="presentation"><a href="#">丰宁店</a></li>
                <li role="presentation"><a href="#">嘉和店</a></li>
                <li role="presentation"><a href="#">名都店</a></li>
                <li role="presentation"><a href="#">下板城店</a></li>
              <li role="presentation"><a href="#">课组汇总</a></li>
            </ul>
            <div class="list-tabs container">
                <div class="table" style="display:block;">
                        <div id="tableReport1" style="height:750px;width:100%;overflow: auto;" > </div>
                </div>
                <div class="table" >
                       <div id="tableReport2" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport3" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport4" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport5" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport6" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table" >
                       <div id="tableReport7" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport8" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport9" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport10" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport11" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table" >
                       <div id="tableReport12" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport13" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport14" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport15" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport16" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table" >
                       <div id="tableReport17" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport18" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport19" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport20" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport21" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport22" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
                <div class="table">
                      <div id="tableReport23" style="height:750px;width:1000px;overflow: auto;margin: 0 auto" > </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include "common/footer.html" %}
<script type="text/javascript">
    $('.nav-tabs li').click(function (e) {
        e.preventDefault();
        $(this).addClass("active").siblings().removeClass("active");
        i=$(this).index();
        $(".list-tabs .table").eq(i).show().siblings().hide();
        //加载数据
        initDate(i+1);
    })

    $(".card_tab1 .con ul li").click(function(){
        $(this).stop().animate({width:"600px"},300).siblings().stop().animate({width:"26px"},300)
    });
    $("#btnExport").on("click",function(){
         window.location.href="{% url 'zeroStockTop' %}?qtype=2";
    });
</script>
<script>
    $(function(){
         initDate(1);
     });
    function initDate(tab){
        var fixedRow,fixedCol;
        var mergeCellsList=[];
        var table = [];
        var rowLight = [];
        var listShops = {{listShops | safe }};
        var listShopTotal = {{ listShopTotal | safe }}

        lenShops = listShops.length;
        if(tab==1){
            var tody = new Date();
            var yesterday = getYestodayDate(tody);
            yesterday = yesterday.getDate();
            fixedRow = 2;
            fixedCol = 6;
            var theadRow1 = {'ShopID':'门店编码','shopname':'门店名称','qtyzSum':'月累计排名（不含联营）','qtylSum':'','zhonbiSum':'','mingciSum':''};
            var theadRow2 = {'ShopID':'','shopname':'','qtyzSum':'有效商品数','qtylSum':'合计','zhonbiSum':'占比','mingciSum':'名次'};
            mergeCellsList = [
                {row: 0, col: 0, rowspan: 2, colspan: 1},
                {row: 0, col: 1, rowspan: 2, colspan: 1},
                {row: 0, col: 2, rowspan: 1, colspan: 4}
            ];
            var i=0;
            var j=1;
            var k=6;
            do{
                if(j<10){
                    //第一行表头
                    theadRow1['qtyz_0'+j]=j.toString()+'日排名(不含联营)';
                    theadRow1['qtyl_0'+j]='';
                    theadRow1['zhonbi_0'+j]='';
                    theadRow1['mingci_0'+j]= '';
                    //第二行表头
                    theadRow2['qtyz_0'+j]='有效商品数';
                    theadRow2['qtyl_0'+j]='合计';
                    theadRow2['zhonbi_0'+j]='占比';
                    theadRow2['mingci_0'+j]= '名次';
                }else{
                    //第一行表头
                    theadRow1['qtyz_'+j]=j.toString()+'日排名(不含联营)';
                    theadRow1['qtyl_'+j]='';
                    theadRow1['zhonbi_'+j]='';
                    theadRow1['mingci_'+j]= '';
                    //第二行表头
                    theadRow2['qtyz_'+j]='有效商品数';
                    theadRow2['qtyl_'+j]='合计';
                    theadRow2['zhonbi_'+j]='占比';
                    theadRow2['mingci_'+j]= '名次';
                }
                //单元格合并处理
                var mergeCell = {};
                mergeCell['row'] = 0;
                mergeCell['col'] = k;
                mergeCell['rowspan'] = 1;
                mergeCell['colspan'] = 4;
                mergeCellsList.push(mergeCell);

                i+=4;//每日单元格数量
                j+=1;//日期
                k+=4;//每次合并单元格数量
            }while(i<yesterday*4);
            table.push(theadRow1);
            table.push(theadRow2);
            //拼接tbody数据
            var tbody = {{ listTop | safe }};
            table = table.concat(tbody);
            var tfooter = {{ TotalDict.listTotal | safe }}
            table.push(tfooter);
            var len = table.length;
            var mergeCellTotal = {};
            mergeCellTotal['row'] = len - 1;
            mergeCellTotal['col'] = 0;
            mergeCellTotal['rowspan'] = 1;
            mergeCellTotal['colspan'] = 2;
            mergeCellsList.push(mergeCellTotal);
            rowLight=[1,len-1];
        }if(tab>1 && tab<=lenShops+1){
            fixedRow = 1;
            fixedCol = 0;
            var thead={'ShopID':'门店编码','shopname':'门店名称','deptid':'课组编码','deptidname':'课组名称','qtyz':'课组汇总','qtyl':'负库存数','zhonbi':'占比'};
            for(var i=2;i<lenShops+2;i++){
                if(i==tab){
                    var tbody = listShops[i-2];
                    var tfooter = listShopTotal[i-2]
                }
            }
            table.push(thead);
            table=table.concat(tbody);
            table.push(tfooter);
            var len = table.length;
            //最后一行表格合并处理
            var mergeCellTotal = {};
            mergeCellTotal['row'] = len - 1;
            mergeCellTotal['col'] = 0;
            mergeCellTotal['rowspan'] = 1;
            mergeCellTotal['colspan'] = 2;
            mergeCellsList.push(mergeCellTotal);
            rowLight=[0];
        }if(tab>lenShops+1){
            fixedRow = 1;
            fixedCol = 0;
            var thead={'deptid':'课组编码','deptidname':'课组名称','qtyz':'课组汇总','qtyl':'负库存数','zhonbi':'占比'};
            var tbody = {{listDept | safe}};
            table.push(thead);
            table = table.concat(tbody);
            rowLight=[0];
        }
        initTable(tab,table,fixedRow,fixedCol,mergeCellsList,rowLight)
    }
    var tableSetting = {};
    function initTable(tab,table,fixedRow,fixedCol,mergeCellsList,rowLight){
        tableSetting = {
            data: table,
            colWidths: 140,
            className: "htCenter htMiddle",
            rowHeaders: true,
            colHeaders: true,
            contextMenu: false,
            fixedRowsTop: fixedRow,
            fixedColumnsLeft: fixedCol,
            manualColumnResize: true,
            manualRowMove: true,
            manualColumnMove: true,
            columnSorting: true,
            sortIndicator: true,
            readOnly: true,
            mergeCells: mergeCellsList,
            cells: function (row, col, prop) {
                var cellProperties = {};
                if (row == rowLight[1] || row <= rowLight[0]) { //查找行或列的位置
                    cellProperties.renderer = headerRenderer;
                }
                return cellProperties;
            }
        };
        creatTable(tab,tableSetting)
    }
    var hot1,hot2,hot3,hot4,hot5,hot6,hot7,hot8,hot9,hot10,hot11,hot12,hot13,hot14,hot15,
            hot16,hot17,hot18,hot19,hot20,hot21,hot22,hot23;
    {% comment %}var hots = [];
    for(var i=1;i<lenShops+2;i++){
        var hots[i] = new Object();
    }{% endcomment %}
    function creatTable(tab,tableSetting) {
        var container = document.getElementById('tableReport' + tab);
        if(tab==1){
            if(!hot1){
                hot1 = new Handsontable(container,tableSetting );
            }
        }else if(tab>1 && tab<=lenShops+1){
            if(tab==2){
                if(!hot2){
                    hot2 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==3){
                if(!hot3){
                    hot3 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==4){
                if(!hot4){
                    hot4 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==5){
                if(!hot5){
                    hot5 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==6){
                if(!hot6){
                    hot6 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==7){
                if(!hot7){
                    hot7 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==8){
                if(!hot8){
                    hot8 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==9){
                if(!hot9){
                    hot9 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==10){
                if(!hot10){
                    hot10 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==11){
                if(!hot11){
                    hot11 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==12){
                if(!12){
                    hot12 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==13){
                if(!hot13){
                    hot13 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==14){
                if(!hot14){
                    hot14 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==15){
                if(!hot15){
                    hot15 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==16){
                if(!hot16){
                    hot16 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==17){
                if(!hot17){
                    hot17 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==18){
                if(!hot18){
                    hot18 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==19){
                if(!hot19){
                    hot19 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==20){
                if(!hot20){
                    hot20 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==21){
                if(!hot21){
                    hot21 = new Handsontable(container,tableSetting );
                }
            }
            if(tab==22){
                if(!hot22){
                    hot22 = new Handsontable(container,tableSetting );
                }
            }
        }else if(tab>lenShops+1){
            if(!hot23){
                hot23 = new Handsontable(container,tableSetting );
            }
        }
    }
</script>
</body>
</html>