{% load basefilter %}
<html>
    <head>
        <meta charset="UTF-8">
        <title>商业供应链系统</title>
        <link data-jsfiddle="common" rel="stylesheet" media="screen" href="{{ static }}/js/handsontable/handsontable.full.css">
    </head>
    <body>
        {% include 'common/nav.html' %}
        <div class="notice noticeOrder comWidth">
            <div class="tTitle">
                <a class="button right" href="javascript:void(0);" id="btnExport">导出Excel</a>
                <div class="container">
                   <div id="group_operate1" style="height:770px;width:1250px;overflow: auto;" > </div>
                </div>
            </div>
        </div>
        {% include "common/footer.html" %}
        <script data-jsfiddle="common" src="{{ static }}/js/handsontable/handsontable.full.js"></script>
        <script data-jsfiddle="common" src="{{ static }}/js/handsontable/handsontable.helper.js"></script>
        <script data-jsfiddle="example1">
            current = "ribao";
        </script>

        <script >
             var hot1;
             $(function(){
                 initHot();
                 loadDate(1);

                 $("#btnExport").on("click",function(){
                     window.location.href="{% url 'grpSaleIndex' %}?qtype=2";
                 });
             });
             function loadDate(tab){
                 var today = new Date();
                 var yesterday = getYestodayDate(today);
                 var year = yesterday.getFullYear();
                 var month = yesterday.getMonth()+1;
                 var lastDay = getLastDay(year,month);
                  if(tab==1){
                      var headers = [
                          {'region':'宽广集团销售日报表'},
                          {'region':'数据日期：','shopname':''+getYestoday(today)+'','month_salevalueesti':'单位:元'},
                          {'region':'机构编码：','shopname':'机构名称','day_salevalue':'POS销售数据','day_sale_difference':'批发销售数据'},
                          {'region':'区域','shopid':'店号','shopname':'店名','opentime':'开业时间','type':'类型','day_salevalue':'当日销售','month_salevalue':'月累计销售额','month_salegain':'月毛利','month_tradenumber':'月日均来客数','month_tradeprice':'月客单价'},
                      ];

                      var sum = [{{ sumDict.sum1|safe }},{{ sumDict.sum2|safe }},{{ sumDict.sum3|safe }},{{ sumDict.sum4|safe }}];
                      headers = headers.concat(sum);

                      var data = {{ rlist|safe }};
                      var r = headers.concat(data);
                      hot1.loadData(r);
                  }
             }

             function initHot(){
                  var today = new Date();
                  var yesterday = getYestodayDate(today);
                  var year = yesterday.getFullYear();
                  var month = yesterday.getMonth()+1;
                  var lastDay = getLastDay(year,month);
                  if(!hot1){
                      var cols1 = [5,6,9,10,12,13,15,16,20,21,26,28,29,34,38,39,41,42];
                      var cols2 = [24,32];
                      var group_operate1 = document.getElementById('group_operate1');
                      hot1 = new Handsontable(group_operate1,{
                            colWidths: [80, 50,150, 100,50,100,100,100, 80, 100,100, 80, 80, 80, 80,100,100, 80, 80,80,
                                         100,100,100, 80,100, 80,100, 80,100,100,100, 80,100, 80,100, 80, 80, 100,100,100,
                                         80,100,100,80],
                            rowHeaders: true,
                            colHeaders: true,
                            fixedColumnsLeft:5,
                            fixedRowsTop:5,
                            minSpareRows: 1,
                            contextMenu: false,
                            cells: function (row, col, prop) {
                                var cellProperties = {};
                                if (row <= 4 || (row >= 5 && row <= 8 && col<=4 )) {
                                  cellProperties.renderer = headerRenderer;
                                }

                                if((row==0 && col==0) || (row==1 && col==7)){
                                     cellProperties.renderer = headerTextRenderer;
                                }

                                if(row > 4 && cols1.indexOf(col)!=-1 ){
                                    cellProperties.renderer = rowRenderer1;
                                }
                                else if(row > 4 && cols2.indexOf(col)!=-1 ){
                                    cellProperties.renderer = rowRenderer2;
                                }
                                return cellProperties;
                            },
                            columns: [
                                {data: 'region'},{data: 'shopid'},{data: 'shopname'},{data: 'opentime'},{data: 'type'},
                                {data: 'day_salevalue'},{data: 'day_salevalueesti'}, {data: 'day_sale_difference'},{data: 'day_accomratio'},
                                {data: 'day_tradenumber'},{data: 'day_tradenumberold'},{data: 'day_tradenumber_ynygrowth'},
                                {data: 'day_tradeprice'},{data: 'day_tradepriceold'},{data: 'day_tradeprice_ynygrowth'},{data: 'day_salegain'},
                                {data: 'day_salegainesti'},{data: 'day_salegain_difference'}, {data: 'day_salegain_accomratio'},
                                {data: 'day_grossmargin'}, {data: 'month_salevalue'},{data: 'month_salevalueesti'},{data: 'month_sale_difference'},
                                {data: 'month_accomratio'}, {data: 'month_sale_estimate'},  {data: 'month_complet_progress'},
                                {data: 'month_salevalueold'},{data: 'month_sale_ynygrowth'},{data: 'month_salegain'},{data: 'month_salegainesti'},
                                {data: 'month_salegain_difference'},{data: 'month_salegain_accomratio'},{data: 'month_salegain_estimate'},
                                {data: 'month_salegain_complet_progress'},{data: 'month_salegainold'},{data: 'month_salegain_ynygrowth'},
                                {data: 'month_salegain_grossmargin'},{data: 'month_salegain_grossmarginold'}, {data: 'month_tradenumber'},
                                {data: 'month_tradenumberold'},{data: 'month_tradenumber_ynygrowth'},{data: 'month_tradeprice'},
                                {data: 'month_tradepriceold'},{data: 'month_tradeprice_ynygrowth'},
                            ],
                            mergeCells:[
                              {row: 0, col: 0, rowspan: 1, colspan: 5},
                              {row: 1, col: 0, rowspan: 1, colspan: 2},{row: 1, col: 5, rowspan: 1, colspan: 2},{row: 1, col:7, rowspan: 1, colspan: 2},

                              {row: 2, col: 0, rowspan: 3, colspan: 1},{row: 2, col: 1, rowspan: 3, colspan: 1},{row: 2, col: 2, rowspan: 3, colspan: 1},
                              {row: 2, col: 3, rowspan: 3, colspan: 1},{row: 2, col: 4, rowspan: 3, colspan: 1},{row: 2, col: 5, rowspan: 1, colspan: 15},
                              {row: 2, col: 20, rowspan: 1, colspan: 8},{row: 2, col: 28, rowspan: 1, colspan:10},{row: 2, col: 38, rowspan: 1, colspan:3},
                              {row: 2, col: 41, rowspan: 1, colspan:3},

                              {row: 3, col: 5, rowspan: 1, colspan: 4},{row: 3, col: 9, rowspan: 1, colspan: 3},{row: 3, col: 12, rowspan: 1, colspan: 3},
                              {row: 3, col: 15, rowspan: 1, colspan: 5},{row: 3, col: 20, rowspan: 2, colspan: 1},{row: 3, col: 21, rowspan: 2, colspan: 1},
                              {row: 3, col: 22, rowspan: 2, colspan: 1},{row: 3, col: 23, rowspan: 2, colspan: 1},{row: 3, col: 24, rowspan: 2, colspan: 1},
                              {row: 3, col: 25, rowspan: 2, colspan: 1},{row: 3, col: 26, rowspan: 2, colspan: 1},{row: 3, col: 27, rowspan: 2, colspan: 1},
                              {row: 3, col: 28, rowspan: 2, colspan: 1},{row: 3, col: 29, rowspan: 2, colspan: 1},{row: 3, col: 30, rowspan: 2, colspan: 1},
                              {row: 3, col: 31, rowspan: 2, colspan: 1},{row: 3, col: 32, rowspan: 2, colspan: 1},{row: 3, col: 33, rowspan: 2, colspan: 1},
                              {row: 3, col: 34, rowspan: 2, colspan: 1},{row: 3, col: 35, rowspan: 2, colspan: 1},{row: 3, col: 36, rowspan: 2, colspan: 1},
                              {row: 3, col: 37, rowspan: 2, colspan: 1},{row: 3, col: 38, rowspan: 2, colspan: 1},{row: 3, col: 39, rowspan: 2, colspan: 1},
                              {row: 3, col: 40, rowspan: 2, colspan: 1},{row: 3, col: 41, rowspan: 2, colspan: 1},{row: 3, col: 42, rowspan: 2, colspan: 1},
                              {row: 3, col: 43, rowspan: 2, colspan: 1},{row: 3, col: 44, rowspan: 2, colspan: 1},

                              {row: 5, col: 0, rowspan: 1, colspan: 5},
                              {row: 6, col: 0, rowspan: 1, colspan: 5},
                              {row: 7, col: 0, rowspan: 1, colspan: 5},
                              {row: 8, col: 0, rowspan: 1, colspan: 5},
                              {row: 9, col: 0, rowspan: 11, colspan: 1},
                              {row: 20, col: 0, rowspan: 10, colspan: 1},

                          ]
                      });
                  }

             }

          </script>
    </body>
</html>