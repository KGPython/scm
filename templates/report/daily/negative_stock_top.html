{% load basefilter %}
<html>
<head>
    <meta charset="UTF-8">
    <title>商业供应链系统</title>
    <style>
        .header {
            position: fixed;
            width: 100%;
            top: 0;
        }

    </style>
</head>
<body>
{% include "common/nav.html" %}
<script type="text/javascript" src="{{ static }}/js/handsontable.full.min.js"></script>
<link type="text/css" rel="stylesheet" href="{{ static }}/css/handsontable.css">
<div class="tTitle tTitle-report">
    <h1>负库存排名日报</h1>
</div>
<div id="tableReport"></div>
{% include "common/footer.html" %}
<script>
    var tody = new Date();
    var yesterday = getYestodayDate(tody);
    yesterday = yesterday.getDate()

    var table = [];
    var theadRow1 = {'shopid':'门店编码','shopname':'门店名称','qtyzSum':'月累计排名（不含联营）','qtylSum':'','zhonbiSum':'','mingciSum':''};
    var theadRow2 = {'shopid':'','shopname':'','qtyzSum':'有效商品数','qtylSum':'合计','zhonbiSum':'占比','mingciSum':'名次'};
    var mergeCellsList = [
        {row: 0, col: 0, rowspan: 2, colspan: 1},
        {row: 0, col: 1, rowspan: 2, colspan: 1},
        {row: 0, col: 2, rowspan: 1, colspan: 4}
    ];

    var i=0;
    var j=1;
    var k=6;
    do{
        if(j<10){
            //第一行表头
            theadRow1['qtyz_0'+j]=j.toString()+'日排名(不含联营)';
            theadRow1['qtyl_0'+j]='';
            theadRow1['zhonbi_0'+j]='';
            theadRow1['mingci_0'+j]= '';
            //第二行表头
            theadRow2['qtyz_0'+j]='有效商品数';
            theadRow2['qtyl_0'+j]='合计';
            theadRow2['zhonbi_0'+j]='占比';
            theadRow2['mingci_0'+j]= '名次';
        }else{
            //第一行表头
            theadRow1['qtyz_'+j]=j.toString()+'日排名(不含联营)';
            theadRow1['qtyl_'+j]='';
            theadRow1['zhonbi_'+j]='';
            theadRow1['mingci_'+j]= '';
            //第二行表头
            theadRow2['qtyz_'+j]='有效商品数';
            theadRow2['qtyl_'+j]='合计';
            theadRow2['zhonbi_'+j]='占比';
            theadRow2['mingci_'+j]= '名次';
        }

        //单元格合并处理
        var mergeCell = {};
        mergeCell['row'] = 0;
        mergeCell['col'] = k;
        mergeCell['rowspan'] = 1;
        mergeCell['colspan'] = 4;
        mergeCellsList.push(mergeCell);

        i+=4;//每日单元格数量
        j+=1;//日期
        k+=4;//每次合并单元格数量
    }while(i<yesterday*4);
    table.push(theadRow1);
    table.push(theadRow2);
    //拼接tbody数据
    var tbody = {{ listRes | safe }};
    table = table.concat(tbody);

    var container = document.getElementById('tableReport');
    var hot = new Handsontable(container,{
        data: table,
        colWidths: 140,
        className: "htCenter htMiddle",
        rowHeaders: true,
        colHeaders: true,
        contextMenu: false,
        fixedRowsTop: 2,
        fixedColumnsLeft: 6,
        manualColumnResize: true,
        manualRowMove: true,
        manualColumnMove: true,
        columnSorting: true,
        sortIndicator: true,
        readOnly:true,
        mergeCells: mergeCellsList
    });


{#    var data2 = [#}
{#        {#}
{#            col: '门店编码',#}
{#            col1: '门店',#}
{#            col2: '',#}
{#            col3: '',#}
{#            col4: '',#}
{#            col5: '',#}
{#            col6: '1日排名(不含联营)',#}
{#            col7: '',#}
{#            col8: '',#}
{#            col9: '',#}
{#            col10: '2日排名(不含联营)',#}
{#            col11: '',#}
{#            col12: '',#}
{#            col13: '',#}
{#            col14: '3日排名(不含联营)',#}
{#            col15: '',#}
{#            col16: '',#}
{#            col17: '',#}
{#            col18: '4日',#}
{#            col19: '',#}
{#            col20: '',#}
{#            col21: '',#}
{#        },#}
{#        {#}
{#            col: '',#}
{#            col1: '',#}
{#            col2: '有效商品数',#}
{#            col3: '合计',#}
{#            col4: '占比',#}
{#            col5: '排名',#}
{#            col6: '有效商品数',#}
{#            col7: '合计',#}
{#            col8: '占比',#}
{#            col9: '排名',#}
{#            col10: '有效商品数',#}
{#            col11: '合计',#}
{#            col12: '占比',#}
{#            col13: '排名',#}
{#            col14: '有效商品数',#}
{#            col15: '合计',#}
{#            col16: '占比',#}
{#            col17: '排名',#}
{#            col18: '有效商品数',#}
{#            col19: '合计',#}
{#            col20: '占比',#}
{#            col21: '排名'#}
{#        },#}
{#    ];#}
{##}
</script>
</body>
</html>